import{P}from"./chunk-PNOZVISH-C8ReOwgg.js";import{aa as m,b as A,S as F,dQ as T,dP as E,j as e,H as D,ad as I,ae as M,z as k,dT as G,t as L,x as r,D as C,m as H,bK as O,B as N,T as z,I as R,X as B}from"./index-DwAumO4s.js";import"./chunk-XVFA73MY-2wn5oaa0.js";import"./lodash-izaU7qdk.js";import"./chunk-5AU4DI7M-CpyI9ckD.js";import"./chunk-E3YGDIJC-B2axzREc.js";import{K}from"./chunk-CEEYZHMN-BKk6bsNv.js";import{b as c,u as V,a as X,c as u}from"./chunk-MDIOSTKB-6EE6lyQn.js";import{D as S}from"./date-picker-v8FvKVYS.js";import"./chunk-QIWEFQ5Y-BEMtN2YG.js";import"./chunk-C76H5USB-Czk9z7F7.js";import"./chunk-OI7BBNYW-W2qG8b5b.js";import"./chunk-P3UUX2T6-Bh1hfEeX.js";import"./index-DTjMCBLZ.js";import"./checkbox-DOq5axzy.js";import"./chunk-YEDAFXMB-yC38kXsx.js";import"./chunk-AOFGTNG6-B60NYXgG.js";import"./chunk-WX2SMNCD-C6IClXei.js";import"./plus-mini-BEIseT0I.js";import"./command-bar-CoF7zpoQ.js";import"./index-DAdyAzjh.js";import"./chunk-QAF7PVQE-CPuqIPzv.js";import"./format-CktQ0SPk.js";import"./x-mark-mini-BVLOBz1V.js";import"./prompt-CYx1Z627.js";import"./popover-C1GpxxvS.js";import"./triangle-left-mini-DYy1FE26.js";var Q=m.object({ends_at:m.date().nullable(),starts_at:m.date().nullable(),customer_group_id:m.array(m.object({id:m.string(),name:m.string()}))}),w="cg",U=({priceList:d,customerGroups:g})=>{const{t:s}=A(),{handleSuccess:p}=V(),{setIsOpen:h}=X(),l=I({defaultValues:{ends_at:d.ends_at?new Date(d.ends_at):null,starts_at:d.starts_at?new Date(d.starts_at):null,customer_group_id:g},resolver:M(Q)}),{fields:t,remove:x,append:j}=k({control:l.control,name:"customer_group_id",keyName:"cg_id"}),b=i=>{if(!i.length){l.setValue("customer_group_id",[]),h(w,!1);return}const o=i.map(n=>n.id),a=i.filter(n=>!t.some(f=>f.id===n.id));for(const n of t)o.includes(n.id)||x(t.indexOf(n));j(a),h(w,!1)},{mutateAsync:y}=G(d.id),v=l.handleSubmit(async i=>{var n,f;const o=i.customer_group_id.map(_=>_.id),a={...d.rules};o.length?a.customer_group_id=o:delete a.customer_group_id,await y({starts_at:((n=i.starts_at)==null?void 0:n.toISOString())||null,ends_at:((f=i.ends_at)==null?void 0:f.toISOString())||null,rules:a},{onSuccess:()=>{L.success(s("priceLists.configuration.edit.successToast")),p()},onError:_=>L.error(_.message)})});return e.jsxs(c.Form,{form:l,children:[e.jsx(c.Description,{className:"sr-only",children:s("priceLists.configuration.edit.description")}),e.jsxs(K,{className:"flex flex-1 flex-col overflow-hidden",onSubmit:v,children:[e.jsxs(c.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-auto",children:[e.jsx(r.Field,{control:l.control,name:"starts_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.startsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.startsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(S,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(C,{}),e.jsx(r.Field,{control:l.control,name:"ends_at",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.endsAt.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.endsAt.hint")})]}),e.jsx(r.Control,{children:e.jsx(S,{granularity:"minute",shouldCloseOnSelect:!1,...i})})]}),e.jsx(r.ErrorMessage,{})]})}),e.jsx(C,{}),e.jsx(r.Field,{control:l.control,name:"customer_group_id",render:({field:i})=>e.jsxs(r.Item,{children:[e.jsxs("div",{children:[e.jsx(r.Label,{optional:!0,children:s("priceLists.fields.customerAvailability.label")}),e.jsx(r.Hint,{children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(r.Control,{children:e.jsxs("div",{className:H("bg-ui-bg-component shadow-elevation-card-rest transition-fg grid gap-1.5 rounded-xl py-1.5","aria-[invalid='true']:shadow-borders-error"),role:"application",ref:i.ref,children:[e.jsxs("div",{className:"text-ui-fg-subtle grid gap-1.5 px-1.5 md:grid-cols-2",children:[e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("priceLists.fields.customerAvailability.attribute")}),e.jsx("div",{className:"bg-ui-bg-field shadow-borders-base txt-compact-small rounded-md px-2 py-1.5",children:s("operators.in")})]}),e.jsx("div",{className:"flex items-center gap-1.5 px-1.5",children:e.jsxs(u,{id:w,children:[e.jsx(u.Trigger,{asChild:!0,children:e.jsxs("button",{type:"button",className:"bg-ui-bg-field shadow-borders-base txt-compact-small text-ui-fg-muted flex flex-1 items-center gap-x-2 rounded-md px-2 py-1.5",children:[e.jsx(O,{}),s("priceLists.fields.customerAvailability.placeholder")]})}),e.jsx(u.Trigger,{asChild:!0,children:e.jsx(N,{variant:"secondary",children:s("actions.browse")})}),e.jsxs(u.Content,{children:[e.jsxs(u.Header,{children:[e.jsx(u.Title,{asChild:!0,children:e.jsx(D,{children:s("priceLists.fields.customerAvailability.header")})}),e.jsx(u.Description,{className:"sr-only",children:s("priceLists.fields.customerAvailability.hint")})]}),e.jsx(P,{type:"drawer",setState:b,state:t})]})]})}),t.length>0?e.jsxs("div",{className:"flex flex-col gap-y-1.5",children:[e.jsx(C,{variant:"dashed"}),e.jsx("div",{className:"flex flex-col gap-y-1.5 px-1.5",children:t.map((o,a)=>e.jsxs("div",{className:"bg-ui-bg-field-component shadow-borders-base flex items-center justify-between gap-2 rounded-md px-2 py-0.5",children:[e.jsx(z,{size:"small",leading:"compact",children:o.name}),e.jsx(R,{size:"small",variant:"transparent",type:"button",onClick:()=>x(a),children:e.jsx(B,{})})]},o.cg_id))})]}):null]})}),e.jsx(r.ErrorMessage,{})]})})]}),e.jsx(c.Footer,{className:"shrink-0",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(N,{size:"small",variant:"secondary",children:s("actions.cancel")})}),e.jsx(N,{size:"small",type:"submit",children:s("actions.save")})]})})]})]})},ve=()=>{const{t:d}=A(),{id:g}=F(),{price_list:s,isPending:p,isError:h,error:l}=T(g),t=s==null?void 0:s.rules.customer_group_id,{customer_groups:x,isPending:j,isError:b,error:y}=E({id:t},{enabled:!!(t!=null&&t.length)}),v=(x==null?void 0:x.map(a=>({id:a.id,name:a.name})))||[],i=p?!1:!(t!=null&&t.length&&j),o=!p&&!!s&&i;if(h)throw l;if(b)throw y;return e.jsxs(c,{children:[e.jsx(c.Header,{children:e.jsx(c.Title,{asChild:!0,children:e.jsx(D,{children:d("priceLists.configuration.edit.header")})})}),o&&e.jsx(U,{priceList:s,customerGroups:v})]})};export{ve as Component};
