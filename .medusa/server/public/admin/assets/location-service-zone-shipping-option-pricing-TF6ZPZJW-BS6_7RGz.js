import{u as k}from"./chunk-4L5I5U7R-l_o_36CH.js";import{D as A}from"./chunk-BTWRDYKW-DByg_YvC.js";import{a6 as G,at as E,a8 as f,aj as _,S as H,ac as U,j as e,b as V,ad as Z,ae as q,g as J,r as S,i as Q,l as W,t as v,B as P}from"./index-DwAumO4s.js";import{d as X,c as Y}from"./chunk-VDODP7YI-wfUELBcQ.js";import{c as b}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as ee}from"./chunk-CEEYZHMN-BKk6bsNv.js";import{R as u,u as w}from"./chunk-MDIOSTKB-6EE6lyQn.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-B4vcOU-v.js";import"./index-DTjMCBLZ.js";import"./checkbox-DOq5axzy.js";import"./prompt-CYx1Z627.js";var re=r=>{const o={};return r.forEach(s=>{s.price_rules.length||(o[s.currency_code]=s.amount)}),o},se=r=>{const o={};return r.forEach(s=>{if(s.price_rules.length){const n=s.price_rules[0].value;o[n]=s.amount}}),o},ie=G({region_prices:E(f(),f().or(_()).optional()),currency_prices:E(f(),f().or(_()).optional())});function oe({shippingOption:r}){const{t:o}=V(),{handleSuccess:s}=w(),n=Z({defaultValues:{region_prices:se(r.prices),currency_prices:re(r.prices)},resolver:q(ie)}),{mutateAsync:g,isPending:R}=Y(r.id),{store:d,isLoading:C,isError:L,error:O}=J(),p=S.useMemo(()=>{var t;return((t=d==null?void 0:d.supported_currencies)==null?void 0:t.map(h=>h.currency_code))||[]},[d]),{regions:c,isLoading:F,isError:N,error:T}=Q({fields:"id,name,currency_code",limit:999}),{price_preferences:I}=W({}),{setCloseOnEscape:M}=w(),z=k({name:r.name,currencies:p,regions:c,pricePreferences:I}),B=S.useMemo(()=>[[...p||[],...c||[]]],[p,c]),j=n.handleSubmit(async t=>{const h=Object.entries(t.currency_prices).map(([i,a])=>{if(a===""||a===void 0||!p.some(m=>m.toLowerCase()==i.toLowerCase()))return;const x=b(a),y={currency_code:i,amount:x},l=r.prices.find(m=>m.currency_code===i&&!m.price_rules.length);return l&&(y.id=l.id),y}).filter(i=>!!i),K=Object.entries(t.region_prices).map(([i,a])=>{if(a===""||a===void 0||!(c==null?void 0:c.some(l=>l.id===i)))return;const x=b(a);return{region_id:i,amount:x}}).filter(i=>!!i);await g({prices:[...h,...K]},{onSuccess:()=>{v.success(o("general.success")),s()},onError:i=>{v.error(i.message)}})}),D=C||F||!p||!c;if(L)throw O;if(N)throw T;return e.jsx(u.Form,{form:n,children:e.jsxs(ee,{className:"flex h-full flex-col overflow-hidden",onSubmit:j,children:[e.jsx(u.Header,{}),e.jsx(u.Body,{children:e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(A,{isLoading:D,data:B,columns:z,state:n,onEditingChange:t=>M(!t)})})}),e.jsx(u.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(u.Close,{asChild:!0,children:e.jsx(P,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(P,{size:"small",className:"whitespace-nowrap",isLoading:R,onClick:j,type:"button",children:o("actions.save")})]})})]})})}function xe(){const{so_id:r,location_id:o}=H();if(!r)throw U({message:"Shipping Option ID paramater is missing",status:404});const{shipping_option:s,isError:n,error:g}=X(r,{fields:"*prices,*prices.price_rules"});if(n)throw g;return e.jsx(u,{prev:`/settings/locations/${o}`,children:s&&e.jsx(oe,{shippingOption:s})})}export{xe as Component};
