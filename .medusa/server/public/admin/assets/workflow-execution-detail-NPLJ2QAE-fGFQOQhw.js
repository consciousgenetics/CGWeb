import{b as ee,a as se,g as te,S as D,c as W,d as J,e as F,f as X}from"./chunk-F2N5NI3W-ZhwTy47f.js";import{S as ie}from"./chunk-UR2E444G-DqVmhkyK.js";import{J as re}from"./chunk-3IW4HYUP-CCzWpj_m.js";import{r as c,S as ae,a as ne,j as e,dI as le,b as j,C as T,H as z,aW as oe,W as ce,T as d,$ as A,m as N,c as de,b4 as ue,b5 as fe,I as xe,b0 as me,b6 as ge,eQ as p,ar as he,b7 as _,d3 as pe,L as be}from"./index-DwAumO4s.js";import{u as P,b as je,M as ve,i as I,c as we,s as $,a as ye,m as Ne}from"./proxy-LXLZldeu.js";import{P as Ee}from"./plus-mini-BEIseT0I.js";import{f as Se}from"./format-CktQ0SPk.js";import"./Trans-D3HnFL2W.js";import"./x-mark-mini-BVLOBz1V.js";var _e=Object.defineProperty,C=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,R=(s,t,r)=>t in s?_e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,ke=(s,t)=>{for(var r in t||(t={}))G.call(t,r)&&R(s,r,t[r]);if(C)for(var r of C(t))K.call(t,r)&&R(s,r,t[r]);return s},Ce=(s,t)=>{var r={};for(var i in s)G.call(s,i)&&t.indexOf(i)<0&&(r[i]=s[i]);if(s!=null&&C)for(var i of C(s))t.indexOf(i)<0&&K.call(s,i)&&(r[i]=s[i]);return r};const U=c.forwardRef((s,t)=>{var r=s,{color:i="currentColor"}=r,a=Ce(r,["color"]);return c.createElement("svg",ke({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:t},a),c.createElement("g",{stroke:i,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#a)"},c.createElement("path",{d:"M4.752 9.616 1.935 8.86l-.755 2.817"}),c.createElement("path",{d:"M13.136 8.53a5.729 5.729 0 0 1-11.196.357M10.248 5.384l2.817.755.755-2.817"}),c.createElement("path",{d:"M1.864 6.469a5.729 5.729 0 0 1 11.184-.403"})),c.createElement("defs",null,c.createElement("clipPath",{id:"a"},c.createElement("path",{fill:"#fff",d:"M0 0h15v15H0z"}))))});U.displayName="ArrowPathMini";function L(s){const t=P(()=>je(s)),{isStatic:r}=c.useContext(ve);if(r){const[,i]=c.useState(s);c.useEffect(()=>t.on("change",i),[])}return t}function Le(s){s.values.forEach(t=>t.stop())}function O(s,t){[...t].reverse().forEach(i=>{const a=s.getVariant(i);a&&$(s,a),s.variantChildren&&s.variantChildren.forEach(l=>{O(l,t)})})}function Me(s,t){if(Array.isArray(t))return O(s,t);if(typeof t=="string")return O(s,[t]);$(s,t)}function Oe(){let s=!1;const t=new Set,r={subscribe(i){return t.add(i),()=>void t.delete(i)},start(i,a){I(s,"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.");const l=[];return t.forEach(u=>{l.push(we(u,i,{transitionOverride:a}))}),Promise.all(l)},set(i){return I(s,"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook."),t.forEach(a=>{Me(a,i)})},stop(){t.forEach(i=>{Le(i)})},mount(){return s=!0,()=>{s=!1,r.stop()}}};return r}function Te(){const s=P(Oe);return ye(s.mount,[]),s}class ze{constructor(){this.componentControls=new Set}subscribe(t){return this.componentControls.add(t),()=>this.componentControls.delete(t)}start(t,r){this.componentControls.forEach(i=>{i.start(t.nativeEvent||t,r)})}}const Pe=()=>new ze;function Ve(){return P(Pe)}var Ze=({execution:s})=>{var l;const{t}=j(),r=s.id.replace("wf_exec_",""),i=se(t,s.state),a=te(s.state);return e.jsxs(T,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-x-0.5",children:[e.jsx(z,{children:r}),e.jsx(oe,{content:r,className:"text-ui-fg-muted"})]}),e.jsx(ce,{color:a,children:i})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("workflowExecutions.workflowIdLabel")}),e.jsx(A,{size:"2xsmall",className:"w-fit",children:s.workflow_id})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("workflowExecutions.transactionIdLabel")}),e.jsx(A,{size:"2xsmall",className:"w-fit",children:s.transaction_id})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 px-6 py-4",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:t("workflowExecutions.progressLabel")}),e.jsx(Ie,{steps:(l=s.execution)==null?void 0:l.steps})]})]})},Ae="_root",Ie=({steps:s})=>{const{t}=j();if(!s)return e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:t("workflowExecutions.stepsCompletedLabel",{completed:0,total:0})});const r=Object.values(s).filter(a=>a.id!==Ae),i=r.filter(a=>a.invoke.state==="done");return e.jsxs("div",{className:"flex w-fit items-center gap-x-2",children:[e.jsx("div",{className:"flex items-center gap-x-[3px]",children:r.map(a=>e.jsx("div",{className:N("bg-ui-bg-switch-off shadow-details-switch-background h-3 w-1.5 rounded-full",{"bg-ui-fg-muted":a.invoke.state==="done"})},a.id))}),e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:t("workflowExecutions.stepsCompletedLabel",{completed:i.length,count:r.length})})]})},Re=({execution:s})=>{var u,g;const{t}=j(),i=Object.values(((u=s.execution)==null?void 0:u.steps)||{}).filter(n=>n.id!=="_root"),a=(g=i.find(n=>n.invoke.status==="permanent_failure"))==null?void 0:g.id,l=a?i.filter(n=>n.id!==a&&n.id.includes(a)).map(n=>n.id):[];return e.jsxs(T,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(z,{level:"h2",children:t("workflowExecutions.history.sectionTitle")})}),e.jsx("div",{className:"flex flex-col gap-y-0.5 px-6 py-4",children:i.map((n,f)=>{var h,E;const m=n.id.split(".").pop();if(!m)return null;const v=(h=s.context)==null?void 0:h.data.invoke[m],b=(E=s.context)==null?void 0:E.errors.find(w=>w.action===m);return e.jsx(He,{step:n,stepInvokeContext:v,stepError:b,isLast:f===i.length-1,isUnreachable:l.includes(n.id)},n.id)})})]})},He=({step:s,stepInvokeContext:t,stepError:r,isLast:i,isUnreachable:a})=>{var b,h;const[l,u]=c.useState(!1),g=c.useRef(null),{hash:n}=de(),{t:f}=j(),m=s.id.split(".").pop();c.useEffect(()=>{n===`#${m}`&&u(!0)},[n,m]);const v=s.id.split(".").pop();return e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-start gap-x-2 px-2",id:m,children:[e.jsxs("div",{className:"grid h-full grid-rows-[20px_1fr] items-center justify-center gap-y-0.5",children:[e.jsx("div",{className:"flex size-5 items-center justify-center",children:e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-2.5 items-center justify-center rounded-full",children:e.jsx("div",{className:N("size-1.5 rounded-full",{"bg-ui-tag-neutral-bg":D.includes(s.invoke.state),"bg-ui-tag-green-icon":W.includes(s.invoke.state),"bg-ui-tag-orange-icon":J.includes(s.invoke.state),"bg-ui-tag-red-icon":F.includes(s.invoke.state),"bg-ui-tag-neutral-icon":X.includes(s.invoke.state)})})})}),e.jsx("div",{className:"flex h-full flex-col items-center",children:e.jsx("div",{"aria-hidden":!0,role:"presentation",className:N({"bg-ui-border-base h-full min-h-[14px] w-px":!i})})})]}),e.jsxs(ue,{open:l,onOpenChange:u,children:[e.jsx(fe,{asChild:!0,children:e.jsxs("div",{className:"group flex cursor-pointer items-start justify-between outline-none",children:[e.jsx(d,{size:"small",leading:"compact",weight:"plus",children:v}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(Be,{state:s.invoke.state,startedAt:s.startedAt,isUnreachable:a}),e.jsx(xe,{size:"2xsmall",variant:"transparent",children:e.jsx(me,{className:"text-ui-fg-muted transition-transform group-data-[state=open]:rotate-180"})})]})]})}),e.jsx(ge,{ref:g,children:e.jsxs("div",{className:"flex flex-col gap-y-2 pb-4 pt-2",children:[e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2",children:[e.jsx(d,{size:"small",leading:"compact",children:f("workflowExecutions.history.definitionLabel")}),e.jsx(p,{snippets:[{code:JSON.stringify(s.definition,null,2),label:f("workflowExecutions.history.definitionLabel"),language:"json",hideLineNumbers:!0}],children:e.jsx(p.Body,{})})]}),t&&e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2",children:[e.jsx(d,{size:"small",leading:"compact",children:f("workflowExecutions.history.outputLabel")}),e.jsx(p,{snippets:[{code:JSON.stringify(((b=t==null?void 0:t.output)==null?void 0:b.output)??{},null,2),label:f("workflowExecutions.history.outputLabel"),language:"json",hideLineNumbers:!0}],children:e.jsx(p.Body,{})})]}),!!(t!=null&&t.output.compensateInput)&&s.compensate.state==="reverted"&&e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2",children:[e.jsx(d,{size:"small",leading:"compact",children:f("workflowExecutions.history.compensateInputLabel")}),e.jsx(p,{snippets:[{code:JSON.stringify(((h=t==null?void 0:t.output)==null?void 0:h.compensateInput)??{},null,2),label:f("workflowExecutions.history.compensateInputLabel"),language:"json",hideLineNumbers:!0}],children:e.jsx(p.Body,{})})]}),r&&e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-2",children:[e.jsx(d,{size:"small",leading:"compact",children:f("workflowExecutions.history.errorLabel")}),e.jsx(p,{snippets:[{code:JSON.stringify({error:r.error,handlerType:r.handlerType},null,2),label:f("workflowExecutions.history.errorLabel"),language:"json",hideLineNumbers:!0}],children:e.jsx(p.Body,{})})]})]})})]})]})},Be=({state:s,startedAt:t,isUnreachable:r})=>{const{t:i}=j(),a=s==="failed",l=s==="invoking",u=s==="skipped",g=s==="skipped_failure";if(r)return null;if(l)return e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:i("workflowExecutions.history.runningState")}),e.jsx(he,{className:"text-ui-fg-interactive animate-spin"})]});let n;if(u?n=i("workflowExecutions.history.skippedState"):g?n=i("workflowExecutions.history.skippedFailureState"):a&&(n=i("workflowExecutions.history.failedState")),n!==null)return e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:n});if(t)return e.jsx(d,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:Se(t,"dd MMM yyyy HH:mm:ss")})},De=({execution:s})=>{var r,i;let t=(i=(r=s.context)==null?void 0:r.data)==null?void 0:i.payload;return t?(typeof t!="object"&&(t={input:t}),e.jsx(re,{data:t})):null},We=({execution:s})=>{const{t}=j();return e.jsxs(T,{className:"overflow-hidden px-0 pb-8 pt-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(z,{level:"h2",children:t("general.timeline")})}),e.jsx("div",{className:"w-full overflow-hidden border-y",children:e.jsx(Ge,{execution:s})})]})},Je=s=>{const t=Object.values(s).filter(i=>i.id!=="_root"),r={};return t.forEach(i=>{r[i.depth]||(r[i.depth]=[]),r[i.depth].push(i)}),r},Fe=(s,t)=>{const r=t+1;return s[r]},k={x:-860,y:-1020,scale:1},Xe=1.5,$e=.5,H=.25,Ge=({execution:s})=>{var V;const[t,r]=c.useState(1),[i,a]=c.useState(!1),l=L(k.scale),u=L(k.x),g=L(k.y),n=Te(),f=Ve(),m=c.useRef(null),v=t<Xe,b=t>$e;c.useEffect(()=>{const o=l.on("change",x=>{r(x)});return()=>{o()}},[l]);const h=Je(((V=s.execution)==null?void 0:V.steps)||{});function E(o,x,y,S){const Z=x/o;return{x:y*Z,y:S*Z}}const w=o=>{const{x,y}=E(t,o,u.get(),g.get());r(o),n.set({scale:o,x,y})},Y=()=>{const o=l.get();if(o<1.5){const x=o+H;w(x)}},Q=()=>{const o=l.get();if(o>.5){const x=o-H;w(x)}},q=()=>{n.start(k)};return e.jsx("div",{className:"h-[400px] w-full",children:e.jsxs("div",{ref:m,className:"relative size-full",children:[e.jsx("div",{className:"relative size-full overflow-hidden object-contain",children:e.jsx("div",{children:e.jsx(Ne.div,{onMouseDown:()=>a(!0),onMouseUp:()=>a(!1),drag:!0,dragConstraints:m,dragElastic:0,dragMomentum:!1,dragControls:f,initial:!1,animate:n,transition:{duration:.25},style:{x:u,y:g,scale:l},className:N("bg-ui-bg-subtle relative size-[500rem] origin-top-left items-start justify-start overflow-hidden","bg-[radial-gradient(var(--border-base)_1.5px,transparent_0)] bg-[length:20px_20px] bg-repeat",{"cursor-grab":!i,"cursor-grabbing":i}),children:e.jsx("main",{className:"size-full",children:e.jsx("div",{className:"absolute left-[1100px] top-[1100px] flex select-none items-start",children:Object.entries(h).map(([o,x])=>{const y=Fe(h,Number(o));return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex flex-col justify-center gap-y-2",children:x.map(S=>e.jsx(Qe,{step:S},S.id))}),e.jsx(Ye,{next:y})]},o)})})})})})}),e.jsxs("div",{className:"bg-ui-bg-base shadow-borders-base text-ui-fg-subtle absolute bottom-4 left-6 flex h-7 items-center overflow-hidden rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:Y,type:"button",disabled:!v,"aria-label":"Zoom in",className:"disabled:text-ui-fg-disabled transition-fg hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed border-r p-1 outline-none",children:e.jsx(Ee,{})}),e.jsx("div",{children:e.jsxs(_,{children:[e.jsx(_.Trigger,{className:"disabled:text-ui-fg-disabled transition-fg hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed flex w-[50px] items-center justify-center border-r p-1 outline-none",children:e.jsxs(d,{as:"span",size:"xsmall",leading:"compact",className:"select-none tabular-nums",children:[Math.round(t*100),"%"]})}),e.jsx(_.Content,{children:[50,75,100,125,150].map(o=>e.jsxs(_.Item,{onClick:()=>w(o/100),children:[o,"%"]},o))})]})}),e.jsx("button",{onClick:Q,type:"button",disabled:!b,"aria-label":"Zoom out",className:"disabled:text-ui-fg-disabled transition-fg hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed border-r p-1 outline-none",children:e.jsx(pe,{})})]}),e.jsx("button",{onClick:q,type:"button","aria-label":"Reset canvas",className:"disabled:text-ui-fg-disabled transition-fg hover:bg-ui-bg-base-hover active:bg-ui-bg-base-pressed focus-visible:bg-ui-bg-base-pressed p-1 outline-none",children:e.jsx(U,{})})]})]})})},M=()=>e.jsx("svg",{width:"42",height:"12",viewBox:"0 0 42 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M41.5303 6.53033C41.8232 6.23744 41.8232 5.76256 41.5303 5.46967L36.7574 0.696699C36.4645 0.403806 35.9896 0.403806 35.6967 0.696699C35.4038 0.989593 35.4038 1.46447 35.6967 1.75736L39.9393 6L35.6967 10.2426C35.4038 10.5355 35.4038 11.0104 35.6967 11.3033C35.9896 11.5962 36.4645 11.5962 36.7574 11.3033L41.5303 6.53033ZM0.999996 5.25C0.585785 5.25 0.249996 5.58579 0.249996 6C0.249996 6.41421 0.585785 6.75 0.999996 6.75V5.25ZM41 5.25L0.999996 5.25V6.75L41 6.75V5.25Z",fill:"var(--border-strong)"})}),Ke=()=>e.jsx("svg",{width:"22",height:"38",viewBox:"0 0 22 38",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"-mt-[6px]",children:e.jsx("path",{d:"M0.999878 32H0.249878V32.75H0.999878V32ZM21.5284 32.5303C21.8213 32.2374 21.8213 31.7626 21.5284 31.4697L16.7554 26.6967C16.4625 26.4038 15.9876 26.4038 15.6947 26.6967C15.4019 26.9896 15.4019 27.4645 15.6947 27.7574L19.9374 32L15.6947 36.2426C15.4019 36.5355 15.4019 37.0104 15.6947 37.3033C15.9876 37.5962 16.4625 37.5962 16.7554 37.3033L21.5284 32.5303ZM0.249878 0L0.249878 32H1.74988L1.74988 0H0.249878ZM0.999878 32.75L20.998 32.75V31.25L0.999878 31.25V32.75Z",fill:"var(--border-strong)"})}),B=()=>e.jsx("svg",{width:"22",height:"38",viewBox:"0 0 22 38",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"-mt-[6px]",children:e.jsx("path",{d:"M21.5284 32.5303C21.8213 32.2374 21.8213 31.7626 21.5284 31.4697L16.7554 26.6967C16.4625 26.4038 15.9876 26.4038 15.6947 26.6967C15.4019 26.9896 15.4019 27.4645 15.6947 27.7574L19.9374 32L15.6947 36.2426C15.4019 36.5355 15.4019 37.0104 15.6947 37.3033C15.9876 37.5962 16.4625 37.5962 16.7554 37.3033L21.5284 32.5303ZM0.249878 0L0.249878 28H1.74988L1.74988 0H0.249878ZM4.99988 32.75L20.998 32.75V31.25L4.99988 31.25V32.75ZM0.249878 28C0.249878 30.6234 2.37653 32.75 4.99988 32.75V31.25C3.20495 31.25 1.74988 29.7949 1.74988 28H0.249878Z",fill:"var(--border-strong)"})}),Ue=({depth:s})=>{if(s===1)return e.jsx(M,{});if(s===2)return e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx(M,{}),e.jsx(B,{})]});const t=Array.from({length:s-2}).map((r,i)=>e.jsx(Ke,{},i));return e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx(M,{}),t,e.jsx(B,{})]})},Ye=({next:s})=>s?e.jsx("div",{className:"-ml-[5px] -mr-[7px] w-[60px] pr-[7px]",children:e.jsxs("div",{className:"flex min-h-[24px] w-full items-start",children:[e.jsx("div",{className:"flex h-6 w-2.5 items-center justify-center",children:e.jsx("div",{className:"bg-ui-button-neutral shadow-borders-base size-2.5 shrink-0 rounded-full"})}),e.jsx("div",{className:"pt-1.5",children:e.jsx(Ue,{depth:s.length})})]})}):null,Qe=({step:s})=>{if(s.id==="_root")return null;const t=s.id.split(".").pop(),r=()=>{if(!t)return;const i=document.getElementById(t);i&&setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"end"})},100)};return e.jsx(be,{to:`#${t}`,onClick:r,className:"focus-visible:shadow-borders-focus transition-fg rounded-md outline-none",children:e.jsxs("div",{className:"bg-ui-bg-base shadow-borders-base flex min-w-[120px] items-center gap-x-0.5 rounded-md p-0.5","data-step-id":s.id,children:[e.jsx("div",{className:"flex size-5 items-center justify-center",children:e.jsx("div",{className:N("size-2 rounded-sm shadow-[inset_0_0_0_1px_rgba(0,0,0,0.12)]",{"bg-ui-tag-neutral-bg":D.includes(s.invoke.state),"bg-ui-tag-green-icon":W.includes(s.invoke.state),"bg-ui-tag-orange-icon":J.includes(s.invoke.state),"bg-ui-tag-red-icon":F.includes(s.invoke.state),"bg-ui-tag-neutral-icon":X.includes(s.invoke.state)})})}),e.jsx(d,{size:"xsmall",leading:"compact",weight:"plus",className:"select-none",children:t})]})})},os=()=>{const{id:s}=ae(),{workflow_execution:t,isLoading:r,isError:i,error:a}=ee(s),{getWidgets:l}=ne();if(r||!t)return e.jsx(le,{sections:4,showJSON:!0});if(i)throw a;return e.jsxs(ie,{widgets:{after:l("workflow.details.after"),before:l("workflow.details.before")},data:t,showJSON:!0,children:[e.jsx(Ze,{execution:t}),e.jsx(We,{execution:t}),e.jsx(De,{execution:t}),e.jsx(Re,{execution:t})]})};export{os as Component};
