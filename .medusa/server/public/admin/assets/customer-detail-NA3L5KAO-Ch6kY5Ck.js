import{u as E,a as I,b as _}from"./chunk-QIWEFQ5Y-BEMtN2YG.js";import{S as Q,d as L,dX as M,a as B,j as e,dI as K,q as f,b as w,u as O,dY as H,C as S,H as T,W as F,A as k,T as u,r as P,dP as Y,k as $,bA as o,L as J,B as W,p as Z,s as D,t as p,dZ as X,d_ as U}from"./index-DwAumO4s.js";import{S as V}from"./chunk-UR2E444G-DqVmhkyK.js";import"./chunk-3IW4HYUP-CCzWpj_m.js";import{u as ee,D as se}from"./chunk-XVFA73MY-2wn5oaa0.js";import"./lodash-izaU7qdk.js";import"./chunk-5AU4DI7M-CpyI9ckD.js";import"./chunk-E3YGDIJC-B2axzREc.js";import{P as G}from"./pencil-square-Bi2c-pS8.js";import{T as R}from"./trash-CHGjMP8t.js";import{u as y}from"./use-prompt-CSTn0lsI.js";import{C}from"./checkbox-DOq5axzy.js";import{c as te}from"./index-DTjMCBLZ.js";import"./chunk-C76H5USB-Czk9z7F7.js";import"./chunk-OI7BBNYW-W2qG8b5b.js";import"./chunk-P3UUX2T6-Bh1hfEeX.js";import"./Trans-D3HnFL2W.js";import"./x-mark-mini-BVLOBz1V.js";import"./chunk-YEDAFXMB-yC38kXsx.js";import"./chunk-AOFGTNG6-B60NYXgG.js";import"./chunk-WX2SMNCD-C6IClXei.js";import"./plus-mini-BEIseT0I.js";import"./command-bar-CoF7zpoQ.js";import"./index-DAdyAzjh.js";import"./chunk-QAF7PVQE-CPuqIPzv.js";import"./format-CktQ0SPk.js";import"./date-picker-v8FvKVYS.js";import"./popover-C1GpxxvS.js";import"./triangle-left-mini-DYy1FE26.js";import"./prompt-CYx1Z627.js";var ae=({customer:s})=>{const{t}=w(),a=y(),r=O(),{mutateAsync:n}=H(s.id),c=[s.first_name,s.last_name].filter(Boolean).join(" "),i=s.has_account?"green":"orange",m=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),g=async()=>{await a({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await n(void 0,{onSuccess:()=>{p.success(t("customers.delete.successToast",{email:s.email})),r("/customers",{replace:!0})},onError:x=>{p.error(x.message)}})};return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(F,{color:i,children:m}),e.jsx(k,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(G,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(R,{}),onClick:g}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:c||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},h=10,re=({customer:s})=>{const t=y(),[a,r]=P.useState({}),{raw:n,searchParams:c}=E({pageSize:h}),{customer_groups:i,count:m,isLoading:g,isError:j,error:x}=Y({...c,fields:"+customers.id",customers:{id:s.id}},{placeholderData:$}),A=I(),v=ie(s.id),{table:N}=ee({data:i??[],columns:v,count:m,getRowId:d=>d.id,enablePagination:!0,enableRowSelection:!0,pageSize:h,rowSelection:{state:a,updater:r}}),z=async()=>{const d=Object.keys(a);if(await t({title:o("general.areYouSure"),description:o("customers.groups.removeMany",{groups:i==null?void 0:i.filter(l=>d.includes(l.id)).map(l=>l.name).join(",")}),confirmText:o("actions.remove"),cancelText:o("actions.cancel")}))try{const l=d.map(q=>D.admin.customerGroup.batchCustomers(q,{remove:[s.id]}));await Promise.all(l),await f.invalidateQueries({queryKey:X.lists()})}catch(l){p.error(l.message)}};if(j)throw x;return e.jsxs(S,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(T,{level:"h2",children:o("customerGroups.domain")}),e.jsx(J,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(W,{variant:"secondary",size:"small",children:o("general.add")})})]}),e.jsx(se,{table:N,columns:v,pageSize:h,isLoading:g,count:m,navigateTo:d=>`/customer-groups/${d.id}`,filters:A,search:!0,pagination:!0,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],commands:[{action:z,label:o("actions.remove"),shortcut:"r"}],queryObject:n,noRecords:{message:o("customers.groups.list.noRecordsMessage")}})]})},oe=({group:s,customerId:t})=>{const a=y(),{t:r}=w(),{mutateAsync:n}=U(s.id),c=async()=>{await a({title:r("general.areYouSure"),description:r("customers.groups.remove",{name:s.name}),confirmText:r("actions.remove"),cancelText:r("actions.cancel")})&&await n([t],{onError:m=>{p.error(m.message)}})};return e.jsx(k,{groups:[{actions:[{label:r("actions.edit"),icon:e.jsx(G,{}),to:`/customer-groups/${s.id}/edit`},{label:r("actions.remove"),onClick:c,icon:e.jsx(R,{})}]}]})},b=te(),ie=s=>{const t=_();return P.useMemo(()=>[b.display({id:"select",header:({table:a})=>e.jsx(C,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:r=>a.toggleAllPageRowsSelected(!!r)}),cell:({row:a})=>e.jsx(C,{checked:a.getIsSelected(),onCheckedChange:r=>a.toggleSelected(!!r),onClick:r=>{r.stopPropagation()}})}),...t,b.display({id:"actions",cell:({row:a})=>e.jsx(oe,{group:a.original,customerId:s})})],[t])},Le=()=>{const{id:s}=Q(),t=L(),{customer:a,isLoading:r,isError:n,error:c}=M(s,void 0,{initialData:t}),{getWidgets:i}=B();if(r||!a)return e.jsx(K,{sections:2,showJSON:!0,showMetadata:!0});if(n)throw c;return e.jsxs(V,{widgets:{before:i("customer.details.before"),after:i("customer.details.after")},data:a,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(ae,{customer:a}),e.jsx(re,{customer:a})]})},ne=s=>({queryKey:Z.detail(s),queryFn:async()=>D.admin.customer.retrieve(s)}),Me=async({params:s})=>{const t=s.id,a=ne(t);return f.getQueryData(a.queryKey)??await f.fetchQuery(a)};export{Le as Component,Me as loader};
